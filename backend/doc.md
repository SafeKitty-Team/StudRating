# Документация API для фронтенд-разработчика

## Содержание
1. [Общая информация](#общая-информация)
2. [Аутентификация](#аутентификация)
3. [Управление пользователями](#управление-пользователями)
4. [Отзывы](#отзывы)
5. [Факультеты](#факультеты)
6. [Программы обучения](#программы-обучения)
7. [Предметы](#предметы)
8. [Преподаватели](#преподаватели)
9. [Модели данных](#модели-данных)

## Общая информация

API представляет собой бэкенд для системы отзывов об образовательном учреждении. Система позволяет оставлять отзывы о преподавателях, предметах, программах обучения и факультетах.

### Базовый URL
```
http://localhost:8000
```

### Типы сущностей для отзывов
- `professor` - преподаватель
- `subject` - предмет
- `program` - программа обучения
- `faculty` - факультет
- `course_professor` - связь преподаватель-предмет

## Аутентификация

### Регистрация
**POST** `/auth/register`
- **Требует аутентификации:** Нет
- **Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```
- **Успешный ответ:** Status 201
```json
{
  "message": "User created successfully"
}
```

### Вход в систему
**POST** `/auth/login`
- **Требует аутентификации:** Нет
- **Тело запроса:** form-data
```
username: user@example.com  // Обратите внимание, что поле называется username, но это email
password: password123
```
- **Успешный ответ:** Status 200
```json
{
  "access_token": "eyJhbGciOiJSUzI1NiI...",
  "token_type": "bearer"
}
```

### Выход из системы
**POST** `/auth/logout`
- **Требует аутентификации:** Да
- **Успешный ответ:** Status 200
```json
{
  "message": "Successfully logged out"
}
```

## Управление пользователями

> **Примечание:** Все эндпоинты в этом разделе требуют прав администратора (`admin` или `superuser`).

### Создание пользователя
**POST** `/users/`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
email: new.user@example.com
password: password123  // Минимум 8 символов, максимум 30
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "roles": "user",
  "created_at": "2025-04-20T10:30:00.000000"
}
```

### Получение информации о пользователе
**GET** `/users/{user_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "roles": "user",
  "created_at": "2025-04-20T10:30:00.000000"
}
```

### Обновление пользователя
**PUT** `/users/{user_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
password: newpassword123  // Опционально, минимум 8 символов, максимум 30
```
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "roles": "user",
  "created_at": "2025-04-20T10:30:00.000000"
}
```

### Удаление пользователя
**DELETE** `/users/{user_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 204 (без тела ответа)

## Отзывы

### Создание отзыва (авторизованный пользователь)
**POST** `/reviews/`
- **Требует аутентификации:** Да
- **Тело запроса:**
```json
{
  "entity_type": "professor",
  "entity_id": 1,
  "course_professor_id": 2,  // Опционально
  "rating_overall": 5,
  "rating_difficulty": 3,
  "rating_usefulness": 4,
  "text_review": "Отличный преподаватель, доступно объясняет материал"
}
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "entity_type": "professor",
  "entity_id": 1,
  "course_professor_id": 2,
  "rating_overall": 5,
  "rating_difficulty": 3,
  "rating_usefulness": 4,
  "text_review": "Отличный преподаватель, доступно объясняет материал",
  "is_on_moderation": false,  // или true, если есть запрещенные слова
  "created_at": "2025-04-20T11:15:30.000000"
}
```

### Создание анонимного отзыва
**POST** `/reviews/anonymous/`
- **Требует аутентификации:** Нет
- **Тело запроса:** Такое же, как для авторизованного отзыва
- **Успешный ответ:** Такой же, как для авторизованного отзыва

### Получение списка отзывов
**GET** `/reviews/`
- **Требует аутентификации:** Нет
- **Параметры запроса:**
    - `skip`: int = 0 (смещение для пагинации)
    - `limit`: int = 100 (количество записей)
- **Успешный ответ:** Status 200
```json
[
  {
    "id": 1,
    "entity_type": "professor",
    "entity_id": 1,
    "course_professor_id": 2,
    "rating_overall": 5,
    "rating_difficulty": 3,
    "rating_usefulness": 4,
    "text_review": "Отличный преподаватель",
    "is_on_moderation": false,
    "created_at": "2025-04-20T11:15:30.000000"
  },
  // Другие отзывы...
]
```

### Получение конкретного отзыва
**GET** `/reviews/{review_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200 (такая же структура, как у одного отзыва из списка выше)

### Получение отзывов для преподавателя-предмета
**GET** `/reviews/course-professor/{course_professor_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200 (массив отзывов, как в `/reviews/`)

### Получение статистики отзывов для сущности
**GET** `/reviews/stats/{entity_type}/{entity_id}`
- **Требует аутентификации:** Нет
- **Параметры запроса:**
    - `include_moderated`: bool = false (включать ли отзывы на модерации)
- **Успешный ответ:** Status 200
```json
{
  "rating_overall": 4.5,
  "rating_difficulty": 3.2,
  "rating_usefulness": 4.1,
  "average_total": 3.93,
  "reviews_count": 15
}
```

### Получение отзывов для сущности
**GET** `/reviews/entity/{entity_type}/{entity_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200 (массив отзывов, как в `/reviews/`)

### Получение отзывов на модерации (для администраторов)
**GET** `/reviews/admin/moderation`
- **Требует аутентификации:** Да, с правами администратора
- **Параметры запроса:**
    - `skip`: int = 0
    - `limit`: int = 100
- **Успешный ответ:** Status 200 (массив отзывов, как в `/reviews/`)

### Одобрение отзыва после модерации (для администраторов)
**POST** `/reviews/admin/approve/{review_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 200 (данные отзыва с is_on_moderation = false)

### Удаление отзыва (для администраторов)
**DELETE** `/reviews/{review_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 204 (без тела ответа)

## Факультеты

### Создание факультета
**POST** `/faculties/`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
name: Факультет информатики
description: Описание факультета  // Опционально
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "name": "Факультет информатики",
  "description": "Описание факультета"
}
```

### Получение информации о факультете
**GET** `/faculties/{faculty_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "name": "Факультет информатики",
  "description": "Описание факультета"
}
```

### Обновление факультета
**PATCH** `/faculties/{faculty_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
name: Новое название  // Опционально
description: Новое описание  // Опционально
```
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "name": "Новое название",
  "description": "Новое описание"
}
```

## Программы обучения

### Создание программы
**POST** `/programs/`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:**
```json
{
  "name": "Информатика и вычислительная техника",
  "degree_level": "bachelor",  // Возможные значения: "specialist", "bachelor", "master", "phd"
  "faculty_id": 1
}
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "name": "Информатика и вычислительная техника",
  "degree_level": "bachelor",
  "faculty_id": 1
}
```

### Получение информации о программе
**GET** `/programs/{program_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "name": "Информатика и вычислительная техника",
  "degree_level": "bachelor",
  "faculty_id": 1
}
```

### Обновление программы
**PUT** `/programs/{program_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** Такое же, как для создания программы
- **Успешный ответ:** Status 200 (обновленные данные программы)

### Удаление программы
**DELETE** `/programs/{program_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 204 (без тела ответа)

## Предметы

### Создание предмета
**POST** `/subjects/`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
name: Программирование
program_id: 1
description: Основы программирования  // Опционально
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "name": "Программирование",
  "description": "Основы программирования",
  "program_id": 1
}
```

### Получение списка предметов
**GET** `/subjects/`
- **Требует аутентификации:** Нет
- **Параметры запроса:**
    - `skip`: int = 0
    - `limit`: int = 100
- **Успешный ответ:** Status 200
```json
[
  {
    "id": 1,
    "name": "Программирование",
    "description": "Основы программирования",
    "program_id": 1
  },
  // Другие предметы...
]
```

### Получение предметов по программе
**GET** `/subjects/program/{program_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200 (массив предметов, как в `/subjects/`)

### Получение информации о предмете
**GET** `/subjects/{subject_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "name": "Программирование",
  "description": "Основы программирования",
  "program_id": 1
}
```

### Обновление предмета
**PATCH** `/subjects/{subject_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
name: Новое название  // Опционально
description: Новое описание  // Опционально
program_id: 2  // Опционально
```
- **Успешный ответ:** Status 200 (обновленные данные предмета)

### Удаление предмета
**DELETE** `/subjects/{subject_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 204 (без тела ответа)

## Преподаватели

### Создание преподавателя
**POST** `/professors/`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
full_name: Иванов Иван Иванович
faculty_id: 1
academic_title: Профессор  // Опционально
bio: Краткая биография  // Опционально
```
- **Успешный ответ:** Status 201
```json
{
  "id": 1,
  "full_name": "Иванов Иван Иванович",
  "academic_title": "Профессор",
  "faculty_id": 1,
  "bio": "Краткая биография"
}
```

### Получение списка преподавателей
**GET** `/professors/`
- **Требует аутентификации:** Нет
- **Параметры запроса:**
    - `skip`: int = 0
    - `limit`: int = 100
- **Успешный ответ:** Status 200
```json
[
  {
    "id": 1,
    "full_name": "Иванов Иван Иванович",
    "academic_title": "Профессор",
    "faculty_id": 1,
    "bio": "Краткая биография"
  },
  // Другие преподаватели...
]
```

### Получение преподавателей по факультету
**GET** `/professors/faculty/{faculty_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200 (массив преподавателей, как в `/professors/`)

### Получение информации о преподавателе
**GET** `/professors/{professor_id}`
- **Требует аутентификации:** Нет
- **Успешный ответ:** Status 200
```json
{
  "id": 1,
  "full_name": "Иванов Иван Иванович",
  "academic_title": "Профессор",
  "faculty_id": 1,
  "bio": "Краткая биография"
}
```

### Обновление преподавателя
**PATCH** `/professors/{professor_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Тело запроса:** form-data
```
full_name: Новое имя  // Опционально
academic_title: Новое звание  // Опционально
faculty_id: 2  // Опционально
bio: Новая биография  // Опционально
```
- **Успешный ответ:** Status 200 (обновленные данные преподавателя)

### Удаление преподавателя
**DELETE** `/professors/{professor_id}`
- **Требует аутентификации:** Да, с правами администратора
- **Успешный ответ:** Status 204 (без тела ответа)

## Модели данных

### Пользователь (User)
```json
{
  "id": 1,
  "roles": "user",  // Возможные значения: "user", "admin", "superuser"
  "created_at": "2025-04-20T10:30:00.000000"
}
```

### Отзыв (Review)
```json
{
  "id": 1,
  "entity_type": "professor",  // Возможные значения: "professor", "subject", "program", "faculty", "course_professor"
  "entity_id": 1,
  "course_professor_id": 2,  // Может быть null
  "rating_overall": 5,  // От 1 до 5
  "rating_difficulty": 3,  // От 1 до 5
  "rating_usefulness": 4,  // От 1 до 5
  "text_review": "Текст отзыва",
  "is_on_moderation": false,
  "created_at": "2025-04-20T11:15:30.000000"
}
```

### Факультет (Faculty)
```json
{
  "id": 1,
  "name": "Название факультета",
  "description": "Описание факультета"  // Может быть null
}
```

### Программа обучения (Program)
```json
{
  "id": 1,
  "name": "Название программы",
  "degree_level": "bachelor",  // Возможные значения: "specialist", "bachelor", "master", "phd"
  "faculty_id": 1
}
```

### Предмет (Subject)
```json
{
  "id": 1,
  "name": "Название предмета",
  "description": "Описание предмета",  // Может быть null
  "program_id": 1
}
```

### Преподаватель (Professor)
```json
{
  "id": 1,
  "full_name": "ФИО преподавателя",
  "academic_title": "Академическое звание",  // Может быть null
  "faculty_id": 1,
  "bio": "Биография преподавателя"  // Может быть null
}
```

### Средние оценки (AverageRatings)
```json
{
  "rating_overall": 4.5,
  "rating_difficulty": 3.2,
  "rating_usefulness": 4.1,
  "average_total": 3.93,
  "reviews_count": 15
}
```

## Обработка ошибок

API возвращает стандартные коды состояния HTTP и JSON-ответы с детализацией ошибок:

```json
{
  "detail": "Описание ошибки"
}
```

Типичные коды ошибок:
- 400 Bad Request - неверный формат запроса
- 401 Unauthorized - отсутствует или неверный токен аутентификации
- 403 Forbidden - недостаточно прав
- 404 Not Found - ресурс не найден
- 422 Unprocessable Entity - ошибка валидации

Я проверил API и кажется, что основная часть была охвачена, но есть несколько моментов, которые можно дополнить:

## Дополнения и уточнения

### Связь предмет-преподаватель (CourseProfessor)
В коде есть модель `CourseProfessor` для связи преподавателей с предметами, но нет отдельных API-эндпоинтов для работы с этими связями. Это потенциальное упущение в API, которое стоит уточнить с бэкенд-разработчиками. Для полнофункционального приложения может потребоваться добавить:
- Создание связи преподаватель-предмет
- Получение списка предметов преподавателя
- Получение списка преподавателей для предмета
- Удаление связи

### Уточнения по аутентификации
- В заголовках авторизованных запросов необходимо указывать токен в формате:
```
Authorization: Bearer <access_token>
```
- Токен JWT имеет срок действия 30 минут (настроено в конфигурации)

### Форматы запросов
Стоит обратить внимание на различия в форматах запросов:
- Эндпоинты для программ (`/programs/`) принимают JSON
- Большинство других эндпоинтов (`/faculties/`, `/professors/`, `/subjects/`) используют form-data
- Отзывы (`/reviews/`) используют JSON

### Обработка ошибок
Важно обрабатывать ошибки аутентификации:
- 401 Unauthorized - возвращается, когда токен отсутствует или истек
- 403 Forbidden - возвращается, когда у пользователя недостаточно прав (не admin/superuser)

### Параметры пагинации
Для эндпоинтов, возвращающих списки, поддерживается пагинация с параметрами:
- `skip` - сколько элементов пропустить (смещение)
- `limit` - максимальное количество элементов в ответе

### Фильтрация отзывов
Для отзывов есть возможность фильтрации по:
- Типу сущности (`entity_type`)
- ID сущности (`entity_id`)
- Необходимости модерации (`is_on_moderation`)

### Технические детали
- Бэкенд использует PostgreSQL
- Для работы с отзывами реализован механизм модерации с проверкой на запрещенные слова

По результатам проверки, основная функциональность API задокументирована правильно и полно.